sap.ui.define(["sap/m/MessageToast","sap/ui/core/Fragment"],function(e,t){"use strict";return{onExcelUpload:function(e){var a=this.getView();if(!this.pDialog){t.load({id:"excel_upload",name:"com.gsitm.pkg.co.zgspkgco0030.ext.fragment.ExcelUpload",type:"XML",controller:this}).then(e=>{var a=t.byId("excel_upload","uploadSet");a.removeAllItems();this.pDialog=e;this.pDialog.open()}).catch(e=>alert(e.message))}else{var o=t.byId("excel_upload","uploadSet");o.removeAllItems();this.pDialog.open()}},onUploadSet:function(t){if(!this.excelSheetsData.length){e.show("업로드할 파일을 선택해주세요.");return}var a=this;var o=t.getSource();var s=function(){return new Promise((e,t)=>{a.callOdata(e,t)})};var r={sActionLabel:o.getText()};this.extensionAPI.securedExecution(s,r);this.pDialog.close()},onTempDownload:function(t){var a=this.getView().getModel();var o=a.getServiceMetadata().dataServices.schema[0].entityType.find(e=>e.name==="CostingTypeMasterType");var s=["Account","Materialclass","Materialtype"];var r=[];var i={};s.forEach((e,t)=>{let a=o.property.find(t=>t.name===e);i[a.extensions.find(e=>e.name==="label").value]=""});r.push(i);const l=XLSX.utils.json_to_sheet(r);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,l,"Sheet1");XLSX.writeFile(n,"원가계산 유형 기준정보.xlsx");e.show("다운로드 중입니다...")},onCloseDialog:function(e){this.pDialog.close()},onBeforeUploadStart:function(e){console.log("File Before Upload Event Fired!!!")},onUploadSetComplete:function(a){var o=t.byId("excel_upload","uploadSet");var s=a.getParameter("item").getFileObject();a.getSource().addItem(new sap.m.upload.UploadSetItem({fileName:s.name,mediaType:s.type}));var r=new FileReader;var i=this;this.excelSheetsData=[];r.onload=e=>{let t=e.currentTarget.result;let a=XLSX.read(t,{type:"binary"});var o=XLSX.utils.sheet_to_row_object_array(a.Sheets["Sheet1"]);a.SheetNames.forEach(function(e){i.excelSheetsData.push(XLSX.utils.sheet_to_row_object_array(a.Sheets[e]))})};r.readAsBinaryString(s);e.show("업로드 되었습니다.")},onItemRemoved:function(e){this.excelSheetsData=[]},callOdata:function(e,t){var a=this.getView().getModel();var o={};this.excelSheetsData[0].forEach((s,r)=>{o={Account:String(s["계정명"]),Materialclass:String(s["평가클래스"]),Materialtype:String(s["이동평균(V)/표준(S)"])};a.create("/CostingTypeMaster",o,{success:t=>{console.log(t);var a=sap.ui.getCore().getMessageManager();var o=new sap.ui.core.message.Message({message:"평가클래스"+t.Materialclass+"가 생성되었습니다.",persistent:true,type:sap.ui.core.MessageType.Success});a.addMessages(o);e()},error:t})})}}});
//# sourceMappingURL=ListReportExt.controller.js.map