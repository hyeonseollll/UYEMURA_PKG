sap.ui.define(["sap/m/MessageToast","sap/ui/core/Fragment"],function(e,t){"use strict";return{onExcelUpload:function(e){var a=this.getView();if(!this.pDialog){t.load({id:"excel_upload",name:"com.gsitm.pkg.co.zgspkgco0010.ext.fragment.ExcelUpload",type:"XML",controller:this}).then(e=>{var a=t.byId("excel_upload","uploadSet");a.removeAllItems();this.pDialog=e;this.pDialog.open()}).catch(e=>alert(e.message))}else{var o=t.byId("excel_upload","uploadSet");o.removeAllItems();this.pDialog.open()}},onUploadSet:function(t){if(!this.excelSheetsData.length){e.show("업로드할 파일을 선택해주세요.");return}var a=this;var o=t.getSource();var s=function(){return new Promise((e,t)=>{a.callOdata(e,t)})};var l={sActionLabel:o.getText()};this.extensionAPI.securedExecution(s,l);this.pDialog.close()},onTempDownload:function(t){var a=this.getView().getModel();var o=a.getServiceMetadata().dataServices.schema[0].entityType.find(e=>e.name==="GLMTMasterType");var s=["MaterialvaluationClass","ClassName","GLAccount","GLAccountName"];var l=[];var r={};s.forEach((e,t)=>{let a=o.property.find(t=>t.name===e);r[a.extensions.find(e=>e.name==="label").value]=""});l.push(r);const i=XLSX.utils.json_to_sheet(l);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,i,"Sheet1");XLSX.writeFile(n,"수불부 GL-평가클래스 기준정보.xlsx");e.show("다운로드 중입니다...")},onCloseDialog:function(e){this.pDialog.close()},onBeforeUploadStart:function(e){console.log("File Before Upload Event Fired!!!")},onUploadSetComplete:function(a){var o=t.byId("excel_upload","uploadSet");var s=a.getParameter("item").getFileObject();a.getSource().addItem(new sap.m.upload.UploadSetItem({fileName:s.name,mediaType:s.type}));var l=new FileReader;var r=this;this.excelSheetsData=[];l.onload=e=>{let t=e.currentTarget.result;let a=XLSX.read(t,{type:"binary"});var o=XLSX.utils.sheet_to_row_object_array(a.Sheets["Sheet1"]);a.SheetNames.forEach(function(e){r.excelSheetsData.push(XLSX.utils.sheet_to_row_object_array(a.Sheets[e]))})};l.readAsBinaryString(s);e.show("업로드 되었습니다.")},onItemRemoved:function(e){this.excelSheetsData=[]},callOdata:function(e,t){var a=this.getView().getModel();var o={};this.excelSheetsData[0].forEach((s,l)=>{o={MaterialvaluationClass:String(s["평가클래스"]),ClassName:String(s["평가클래스명"]),GLAccount:String(s["G/L계정"]),GLAccountName:String(s["G/L계정명"])};a.create("/GLMTMaster",o,{success:t=>{console.log(t);var a=sap.ui.getCore().getMessageManager();var o=new sap.ui.core.message.Message({message:"평가클래스"+t.MaterialvaluationClass+"가 생성되었습니다.",persistent:true,type:sap.ui.core.MessageType.Success});a.addMessages(o);e()},error:t})})}}});
//# sourceMappingURL=ListReportExt.controller.js.map