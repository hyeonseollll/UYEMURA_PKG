sap.ui.define(["sap/m/MessageToast","sap/ui/core/Fragment"],function(e,t){"use strict";return{onExcelUpload:function(e){var a=this.getView();if(!this.pDialog){t.load({id:"excel_upload",name:"com.gsitm.pkg.co.zgspkgco0020.ext.fragment.ExcelUpload",type:"XML",controller:this}).then(e=>{var a=t.byId("excel_upload","uploadSet");a.removeAllItems();this.pDialog=e;this.pDialog.open()}).catch(e=>alert(e.message))}else{var o=t.byId("excel_upload","uploadSet");o.removeAllItems();this.pDialog.open()}},onUploadSet:function(t){if(!this.excelSheetsData.length){e.show("업로드할 파일을 선택해주세요.");return}var a=this;var o=t.getSource();var r=function(){return new Promise((e,t)=>{a.callOdata(e,t)})};var s={sActionLabel:o.getText()};this.extensionAPI.securedExecution(r,s);this.pDialog.close()},onTempDownload:function(t){var a=this.getView().getModel();var o=a.getServiceMetadata().dataServices.schema[0].entityType.find(e=>e.name==="MaterialCateSegType");var r=["Sequence","Materialledgercategory","Materialledgercategorytext"];var s=[];var l={};r.forEach((e,t)=>{let a=o.property.find(t=>t.name===e);l[a.extensions.find(e=>e.name==="label").value]=""});s.push(l);const i=XLSX.utils.json_to_sheet(s);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,i,"Sheet1");XLSX.writeFile(n,"수불부 자재원장 순번 기준정보.xlsx");e.show("다운로드 중입니다...")},onCloseDialog:function(e){this.pDialog.close()},onBeforeUploadStart:function(e){console.log("File Before Upload Event Fired!!!")},onUploadSetComplete:function(a){var o=t.byId("excel_upload","uploadSet");var r=a.getParameter("item").getFileObject();a.getSource().addItem(new sap.m.upload.UploadSetItem({fileName:r.name,mediaType:r.type}));var s=new FileReader;var l=this;this.excelSheetsData=[];s.onload=e=>{let t=e.currentTarget.result;let a=XLSX.read(t,{type:"binary"});var o=XLSX.utils.sheet_to_row_object_array(a.Sheets["Sheet1"]);a.SheetNames.forEach(function(e){l.excelSheetsData.push(XLSX.utils.sheet_to_row_object_array(a.Sheets[e]))})};s.readAsBinaryString(r);e.show("업로드 되었습니다.")},onItemRemoved:function(e){this.excelSheetsData=[]},callOdata:function(e,t){var a=this.getView().getModel();var o={};this.excelSheetsData[0].forEach((r,s)=>{o={Sequence:Number(r["순번"]),Materialledgercategory:String(r["자재원장"]),Materialledgercategorytext:String(r["자재원장범주텍스트"])};a.create("/MaterialCateSeg",o,{success:t=>{console.log(t);var a=sap.ui.getCore().getMessageManager();var o=new sap.ui.core.message.Message({message:"자재원장"+t.Materialledgercategory+"가 생성되었습니다.",persistent:true,type:sap.ui.core.MessageType.Success});a.addMessages(o);e()},error:t})})}}});
//# sourceMappingURL=ListReportExt.controller.js.map